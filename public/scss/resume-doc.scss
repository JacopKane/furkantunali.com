@import "fonts.scss";
@import "common.scss";

html,
body {
  border: 0;
  margin: 0 auto;
  padding: 0;

  font-size: calc((#{$size}) * 1.44);
  line-height: $standard-line-height;

  a {
    &:not(.no-decoration) {
      // @include no-smart-underline();
      text-decoration: underline;
    }
  }

  // Responsive grid for experiences
  #experiences {
    .experience-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      width: 100%;
      list-style-type: none;
      padding: 0;
      margin: 0;

      li.experience {
        // Default to 2 columns
        flex: 1 1 calc(50% - 1em);
        min-width: 280px; // Minimum width before wrapping

        // Allow content to flow naturally
        page-break-inside: auto;
        break-inside: auto;

        // Add a subtle separation between experiences
        margin-bottom: 1em;
      }
    }

    // Second part - true masonry layout with CSS columns
    .experience-grid-second-part {
      // Multi-column layout for masonry effect
      column-count: 2; // Default to 2 columns
      column-gap: 1em;
      width: 100%;
      list-style-type: none;
      padding: 0;
      margin: 0;
      
      li.experience {
        // Each experience must stay in one column (not break across columns)
        display: inline-block; // Important for column layout
        width: 100%;
        break-inside: avoid; // Prevent item from breaking across columns
        page-break-inside: avoid;
        margin-bottom: 1em; // Space between items
        
        // Fix for Safari
        -webkit-column-break-inside: avoid;
        
        // If any experience item has floated content, ensure proper clearing
        &::after {
          content: "";
          display: table;
          clear: both;
        }
      }
    }
  }

  // Simple float-based layout
  .intro {
    overflow: hidden; // Clearfix
    margin-bottom: 1em;
  }

  .left-column {
    float: left;
    width: 48%;
    text-align: left;
  }

  .right-column {
    float: right;
    width: 48%;
    text-align: right;
  }

  // Grid-based positioning for experience columns
  .experience-grid {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 1em;
    padding: 0;
    margin: 0;
    list-style-type: none;
    
    .experience {
      // Default to 2 columns
      flex: 1 1 calc(50% - 1em);
      min-width: 280px;
      
      // Allow breaks for better flow
      break-inside: auto;
      page-break-inside: auto;
      margin-bottom: 0.5em;
      padding: 0;
      box-sizing: border-box;
      
      h3, h4, h5 {
        margin-bottom: 0.1em;
        margin-top: 0;
      }
      
      ul {
        margin-top: 0;
        margin-bottom: 0.1em;
        padding-top: 0;
        padding-bottom: 0;
        
        // Allow breaks inside list items
        li {
          break-inside: auto;
          page-break-inside: auto;
        }
      }
      
      li, p {
        margin-bottom: 0;
        margin-top: 0;
        line-height: 1.3;
      }
    }
  }
}

// Ensure print-specific styles are applied - bare minimum needed
@media print {
  html,
  body {
    padding: 0.2cm !important;
    margin: 0 !important;
    max-width: 100% !important;
    
    .experience-grid {
      width: 100% !important;
      display: flex !important;
      flex-wrap: wrap !important;
      gap: 0.5em !important;
      
      .experience {
        // Two-column layout for print
        flex: 1 1 calc(50% - 0.5em) !important;
        
        // Allow page breaks inside experience items
        break-inside: auto !important;
        page-break-inside: auto !important;
        margin-bottom: 0.3em !important;
        padding: 0 !important;
        
        h3, h4, h5 {
          margin-bottom: 0.05em !important;
          margin-top: 0 !important;
          line-height: 1.2 !important;
        }
        
        ul {
          margin-top: 0 !important;
          margin-bottom: 0.05em !important;
          padding-top: 0 !important;
          padding-bottom: 0 !important;
          
          // Allow page breaks inside list items
          li {
            break-inside: auto !important;
            page-break-inside: auto !important;
          }
        }
        
        li, p {
          margin-bottom: 0 !important;
          margin-top: 0 !important;
          line-height: 1.2 !important;
        }
      }
    }

    .experience-grid-second-part {
      width: 100% !important;
      column-count: 2 !important; // Two columns for print
      column-gap: 0.5em !important;
      
      .experience {
        // Each item stays in one column
        display: inline-block !important;
        width: 100% !important;
        break-inside: avoid !important; // Better layout in print
        page-break-inside: avoid !important;
        margin-bottom: 0.3em !important;
        padding: 0 !important;
      }
    }
  }

  /* Ensure paragraphs don't break in the middle */
  p {
    page-break-inside: avoid;
    break-inside: avoid;
  }
  
  /* Prevent line breaks in the middle of sentences */
  .experience p, li p {
    orphans: 3;
    widows: 3;
  }

  /* Ensure proper spacing between elements */
  section {
    margin-bottom: 1em;
  }

  /* Improve text rendering in PDF */
  body {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    text-rendering: optimizeLegibility;
  }
  
  /* Safari-specific fixes for column-based masonry */
  @media not all and (min-resolution:.001dpcm) {
    @supports (-webkit-appearance:none) {
      #experiences .experience-grid-second-part {
        -webkit-column-break-inside: avoid;
      }
    }
  }
}
