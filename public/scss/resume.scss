@use "sass:color";
@import "fonts.scss";
@import "common.scss";

// Light mode colors (default)
$color-text: #000;
$color-link: #000;
// Use color.adjust instead of lighten() to avoid deprecation warnings
$color-link-hover: color.adjust($color-link, $lightness: 60%);
$color-link-visited: color.adjust($color-link, $lightness: 40%);
$color-background: #fff;

// Dark mode colors
$color-text-dark: #ffffff;
$color-link-dark: #ffffff;
$color-link-hover-dark: color.adjust($color-link-dark, $lightness: -30%);
$color-link-visited-dark: color.adjust($color-link-dark, $lightness: -20%);
$color-background-dark: #000000;

$size: "((1vmin + 1vmax) / 3)";
$size-margin: "((1vmin + 1vmax) / 3) * 2";

// Theme mixins
@mixin light-theme {
  color: $color-text;
  background-color: $color-background;
  
  a {
    color: $color-link;

    &:not(.no-decoration) {
      &:hover {
        color: $color-link-hover;
      }
    }

    &:visited {
      color: $color-link-visited;
    }

    &:hover {
      color: $color-link-hover;
    }
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: $color-text;
  }
  
  nav a:not(.logo) {
    color: $color-link;
    
    &:hover {
      color: $color-link-hover;
    }
  }
  
  footer {
    color: $color-text;
  }
}

@mixin dark-theme {
  color: $color-text-dark;
  background-color: $color-background-dark;
  
  a {
    color: $color-link-dark;

    &:not(.no-decoration) {
      &:hover {
        color: $color-link-hover-dark;
      }
    }

    &:visited {
      color: $color-link-visited-dark;
    }

    &:hover {
      color: $color-link-hover-dark;
    }
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: $color-text-dark;
  }
  
  nav a:not(.logo) {
    color: $color-link-dark;
    
    &:hover {
      color: $color-link-hover-dark;
    }
  }
  
  footer {
    color: color.adjust($color-text-dark, $lightness: -20%);
  }
}

// Logo mixin now available from common.scss

html,
body {
  @include font-family;
  @include light-theme;
  transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;

  font-size: calc(#{$size} * 3.6);
  font-size: clamp(14px, 1vw, 18px); // Smaller base size, limits scaling
  line-height: $standard-line-height;

  @media print {
    font-size: calc(#{$size} * 2.8);
    max-width: 190mm;
    line-height: $standard-line-height;
    margin-top: 0 !important; // Remove any top margin in print
  }
  margin: 0 auto;

  padding: 0;
  a {
    transition: color 0.2s ease;

    &:not(.no-decoration) {
      &:hover {
        color: $color-link-hover;
      }
    }

    &:visited {
      color: $color-link-visited;
    }

    &:hover {
      color: $color-link-hover;
    }
  }

}

// Dark theme application
html.dark-theme,
html.dark-theme body {
  @include dark-theme;
}

body {
  padding: calc(#{$size-margin} / 2);

  .intro {
    overflow: hidden; // Clearfix alternative
    margin-bottom: 1em;
  }

  .left-column {
    float: left;
    width: 48%;
    text-align: left;
    box-sizing: border-box;
  }

  .right-column {
    float: right;
    width: 48%;
    text-align: right;
    box-sizing: border-box;
  }

  a.side-note {
    text-decoration: none;
  }

  h1, h2, h3, h4, h5, h6 {
    color: $color-text;
    transition: color 0.3s ease-in-out;
  }

  h1 {
    font-weight: 100;
    line-height: $standard-line-height;
  }

  h2 {
    font-weight: 300;
    line-height: $standard-line-height;
  }

  h3 {
    font-weight: 500;
    line-height: $standard-line-height;
    em {
      font-weight: 300;
    }
    
    .dates {
      font-weight: 400;
      font-size: 0.85em;
      opacity: 0.85;
      margin-left: 0.5em;
      white-space: nowrap;
    }
  }

  h4 {
    font-weight: 600;
    line-height: $standard-line-height;
  }

  h5 {
    font-weight: 700;
    line-height: $standard-line-height;
  }

  h6 {
    font-weight: 800;
    line-height: $standard-line-height;
  }


  ul,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  section,
  p {
    padding: 0;
    margin: 0;
  }

  nav {
    @media print {
      display: none;
    }

    .logo {
      @include logo(3rem, 0.55, true); // Hover always enabled, small logo
      margin: 0;
    }

    a {
      &:not(.logo) {
        font-size: 1rem;
        text-align: right;
      }
    }

    div.right {
      text-align: right;
    }
  }

  header {
    margin-top: calc((#{$size-margin}) / 2);
  }

  footer {
    font-size: 0.6rem;
    margin-top: calc((#{$size-margin}) / 2);
    text-align: center;
    line-height: $standard-line-height;
    color: $color-text;
    transition: color 0.3s ease-in-out;
  }
  ul.info,
  ul.educations,
  ul.skills {
    li {
      display: inline;
      margin: 0;
      line-height: $standard-line-height;
      &:not(:first-child)::before {
        content: "\00a0\2022\00a0\00a0";
      }
    }
  }

  ul.contact {
    li {
      display: inline;
      margin: 0;
      line-height: $standard-line-height;
      &:not(:first-child)::before {
        content: "";
      }
    }
  }

  .experience {
    break-inside: auto; /* Allow content to flow across pages naturally */
    margin: 0; // Reset all margins
    padding: 0; // Reset all paddings
    border-radius: 4px;
    box-sizing: border-box;

    // Ensure consistent height behavior
    display: flex;
    flex-direction: column;

    h3, h4, h5 {
      margin: 0; // Reset all margins
      padding: 0; // Reset all paddings
    }
    
    // Add bullet styles for nested lists within experiences
    ul {
      padding: 0; // Reset padding
      padding-left: 1.5em; // Only left padding for bullets
      margin: 0; // Reset all margins
      list-style-type: circle; // Nested bullets: hollow circles ○
      list-style-position: outside;
      
      li {
        display: list-item;
        margin: 0; // Reset all margins
        padding: 0; // Reset all paddings
        line-height: 1.3; // Tighter line height
        
        p {
          margin: 0; // Remove paragraph margins
          padding: 0; // Remove paragraph paddings
        }
      }
    }
  }
  
  // Styling for the experiences section
  #experiences {
    // General styles for all experience lists
    > ul.experiences {
      width: 100%;
      max-width: 100%;
      padding: 0; // Reset padding
      padding-left: 1em; // Minimal padding to show bullets
      margin: 0; // Reset margin
      list-style-type: disc; // Parent bullets for experience titles
    }
    
    li.experience {
      // Simple vertical layout with parent bullets
      display: list-item; // Show parent bullets
      width: 100%;
      
      // Allow content to flow naturally
      break-inside: auto;
      
      // Reset all spacing
      margin: 0; // No margins at all
      padding: 0; // No padding at all
      
      // Child bullets (experience details) - different style
      > ul {
        padding: 0; // Reset padding
        padding-left: 1.25em; // Only left padding for child bullets
        margin: 0; // No margins
        list-style-type: circle; // Different bullet style for details
        
        li {
          display: list-item;
          margin: 0; // No margins
          padding: 0; // No padding
        }
      }
    }
  }
}

// Ensure print-specific styles are applied
@media print {
  html, body {
    font-size: 13px !important; // Slightly increased from 12px
    line-height: 1.3 !important; // Slightly increased from 1.2
    margin: 0 !important; // Remove all margins for print
    padding: 0 !important; // Remove all padding for print
    max-width: none !important; // Remove width constraints
    width: 100% !important; // Full width
  }

  body {
    color: #000 !important; // Ensure text is black for better printing
    background: #fff !important; // Ensure background is white
    box-sizing: border-box !important;
  }
  
  // Remove all container margins and paddings
  .container {
    margin: 0 !important;
    padding: 0 !important;
    max-width: none !important;
    width: 100% !important;
  }
  
  // Fix the intro section alignment for print
  .intro {
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: flex-start !important;
    width: 100% !important;
  }
  
  .left-column, .right-column {
    float: none !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 48% !important;
    box-sizing: border-box !important;
  }
  
  .left-column {
    text-align: left !important;
  }
  
  .right-column {
    text-align: right !important;
  }
  
  // Hide navigation in print and remove its space
  nav {
    display: none !important;
  }
  
  // Remove margins and padding from header
  header {
    margin: 0 !important;
    padding: 0 !important;
  }
  
  // Remove margins from header elements
  header hgroup,
  header h1 {
    margin: 0 !important;
    padding: 0 !important;
  }
  
  // Remove top margin from first element to eliminate page top spacing
  body > *:first-child,
  body > *:first-child > *:first-child {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
  
  // Print-specific styles for experiences
  #experiences > ul.experiences {
    width: 100% !important;
    padding-left: 1em !important; // Minimal padding to show bullets in print
    list-style-type: disc !important; // Parent bullets in print
    margin: 0 !important;
    
    li.experience {
      display: list-item !important; // Show parent bullets in print
      width: 100% !important;
      margin: 0 !important; // No spacing at all in print
      padding-left: 0.25em !important; // Pull text closer to bullet in print
      break-inside: auto !important; // Allow page breaks within experiences for better space utilization
      
      // Remove bottom spacing from last experience in print
      &:last-child {
        margin-bottom: 0 !important;
      }
      
      > ul {
        padding-left: 1.25em !important; // Slightly reduced padding for child bullets in print (was 1.5em)
        list-style-type: circle !important; // Child bullets different in print
        margin: 0 !important;
        
        li {
          display: list-item !important;
          margin: 0 !important; // No spacing for child items in print
          padding-left: 0.25em !important; // Pull child text closer to bullets in print
        }
      }
    }
  }

  h1 { 
    font-size: 19px !important; 
    line-height: 1.2 !important; 
    margin-top: 0 !important; // Remove top margin in print
  }
  h2 { 
    font-size: 17px !important; 
    line-height: 1.2 !important; 
    margin-top: 0 !important; // Remove top margin in print
  }
  h3 { 
    font-size: 15px !important; 
    line-height: 1.2 !important; 
    margin-top: 0 !important; // Remove top margin in print
  }
  h4 { 
    font-size: 14px !important; 
    line-height: 1.2 !important; 
    margin-top: 0 !important; // Remove top margin in print
  }
  
  ul, ol, p { 
    margin-top: 0.15em !important; // Increased from 0.1em
    margin-bottom: 0.15em !important; // Increased from 0.1em
    line-height: 1.25 !important; // Increased from 1.2
  }
  
  .experience {
    break-inside: auto !important; /* Allow content to flow across pages */
    margin-bottom: 1em !important; /* Reduced from 1.5em to minimize excessive space */
    padding: 0 !important;
    
    h3, h4, h5 {
      margin-bottom: 0.15em !important; // Increased from 0.1em
      margin-top: 0 !important;
      line-height: 1.2 !important; // Increased from 1.1
      break-after: avoid !important; /* Keep headings with their content */
    }
    
    ul {
      margin-top: 0 !important;
      margin-bottom: 0.1em !important; // Increased from 0.05em
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      padding-left: 1.5em !important;
      list-style-type: disc !important;
      
      li {
        break-inside: auto !important;
        display: list-item !important;
      }
    }
    
    /* Keep the end of one job experience from separating from its header */
    &:last-child {
      break-after: auto !important;
    }
    
    /* Keep title with at least some content */
    h3, h4 {
      break-after: avoid !important;
    }
    
    li, p {
      margin-bottom: 0 !important;
      margin-top: 0 !important;
      line-height: 1.25 !important; // Increased from 1.15
      font-size: 12px !important; // Increased from 11px
    }

    p small {
      font-size: 11px !important; // Increased from 10px
      line-height: 1.2 !important; // Increased from 1.1
    }
  }
  
  /* Force Education and Interests sections to start on new lines but not new pages */
  #education {
    clear: both;
    display: block;
    width: 100%;
    margin-top: 0.8em;
  }
  
  #interests {
    clear: both;
    display: block;
    width: 100%;
    margin-top: 0.8em;
    font-size: 12px !important; // Increased from 11px
    line-height: 1.25 !important; // Increased from 1.15
  }
  
  /* Ensure the education section displays properly */
  .educations {
    padding-left: 0;
    list-style-type: none;
  }
  
  /* Make sure section headings are clearly visible */
  section h2 {
    margin-top: 0.3em; /* Reduced from 0.4em */
    margin-bottom: 0.15em; /* Reduced from 0.2em */
    font-weight: bold;
    break-after: avoid;
  }
  
  /* Make sure content stays with its heading */
  section h2 + * {
    break-before: avoid;
  }
  
  /* Ensure job headings stay with their content */
  .experience h3, .experience h4 {
    break-after: avoid !important;
  }
  
  /* Fix for heyData to Société Générale transition */
  .experience + .experience {
    break-before: auto;
  }
  
  /* Reduce spacing in skills section */
  .skills li {
    margin-bottom: 0.15em !important; // Increased from 0.1em
    line-height: 1.25 !important; // Increased from 1.15
    font-size: 12px !important; // Increased from 11px
    
    strong {
      font-size: 13px !important; // Increased from 12px
    }
  }
  
  /* Add page breaks where needed */
  #education {
    page-break-before: auto;
  }
  
  /* Optimize experiences layout for printing */
  #experiences ul {
    padding: 0 0.5% !important;
  }
  
  /* Hide unnecessary elements */
  .grain-overlay {
    display: none !important;
  }
  
  /* Hide social and web links in print as they're not relevant on paper */
  #contact li:nth-child(2),
  #contact li:nth-child(3),
  #contact li:nth-child(4) {
    display: none !important;
  }
  
  /* Fix text truncation issues with client links */
  .experience > a {
    display: inline-block;
    margin-right: 0.25em;
  }
  
  /* Ensure links print in black without underlines */
  a, a:visited {
    text-decoration: none !important;
    color: #000 !important;
  }
  
  /* Add horizontal rules for better section separation */
  hr {
    border: none;
    border-top: 1px solid #ccc;
    margin: 0.3em 0;
  }
  
  /* Fix for experience items at bottom of page/column */
  li.experience:last-child {
    margin-bottom: 0 !important;
  }
}
